# ä½¿ç”¨ç›®çš„ï¼šè‡ªåŠ¨åŒæ­¥æŒ‡å®šé“¾æ¥æ–‡ä»¶å¹¶ä¿å­˜åˆ°å½“å‰ä»“åº“
# ä½œè€…ï¼šLevi
# åˆ›å»ºæ—¶é—´ï¼š2025/04/25
# æ­é…sync-FILES.pyä½¿ç”¨
# ğŸš¨æ¨èåŒæ­¥å¤‡ä»½åˆ°ä½ çš„ç§æœ‰ä»“åº“ ä½ å¿…é¡»æˆäºˆä»“åº“è¯»å†™æƒé™æ‰å¯ä½¿ç”¨ï¼
# ä½¿ç”¨æ–¹å¼ï¼š
# 1. åœ¨ä»“åº“æ ¹ç›®å½•åˆ›å»º script-gist.json æ–‡ä»¶ï¼Œæ ¼å¼ä¸º {"æ–‡ä»¶åç§°": "æ–‡ä»¶é“¾æ¥"}
# 2. å°† sync_FILES.py æ–‡ä»¶æ”¾å…¥ .github/scripts ç›®å½•ä¸­
# 3. å°†æ­¤å·¥ä½œæµæ–‡ä»¶æ”¾å…¥ .github/workflows/sync_FILES.yml
# 4. åœ¨è®¾ç½®é‡Œä¸ºç¯å¢ƒå˜é‡(envéƒ¨åˆ†)å¢åŠ Secretsä»¥å¯ç”¨é€šçŸ¥ï¼ˆå¯é€‰é¡¹ï¼Œæœªè®¾ç½®åˆ™ä¸æ¨é€ï¼‰
# 5. å¯ç›‘æµ‹é…ç½®æ–‡ä»¶æ”¹åŠ¨æ‰§è¡Œæˆ–æ‰‹åŠ¨è¿è¡Œæˆ–ç­‰å¾…å®šæ—¶è§¦å‘ï¼ˆé»˜è®¤æ¯å¤©æ‰§è¡Œä¸€æ¬¡ï¼‰
# ------------------------------------------------------------------------
# script-gist.json æ–‡ä»¶æ ¼å¼å¦‚ä¸‹ï¼ˆç¤ºä¾‹ï¼‰ï¼š
# {
#   "ç¤ºä¾‹1": "https://raw.githubusercontent.com/example1.js",
#   "ç¤ºä¾‹2": "https://raw.githubusercontent.com/example2.txt",
#   ...,
#   "example": "https://gist.githubusercontent.com/raw/example.json"
# }
# âš ï¸ script-gist.json æ–‡ä»¶æœ€åä¸€ä¸ªé“¾æ¥ä¸éœ€è¦åŠ é€—å·ï¼Œå¦åˆ™æŠ¥é”™ï¼
# ------------------------------------------------------------------------
name: Specific Files Backup via

on:
  schedule:
    - cron: '0 2 * * *'        # UTCæ—¶é—´ åˆ°è§„å®šæ—¶é—´è‡ªåŠ¨æ‰§è¡Œ
  push:                        # ç›‘æµ‹æ–‡ä»¶å†…å®¹æ”¹åŠ¨ è‹¥æœ‰æ”¹åŠ¨è‡ªåŠ¨æ‰§è¡Œ
    paths:
      - 'script-gist.json'     # ç›‘è§†æ ¹ç›®å½•æ–‡ä»¶å¤¹script-gist.jsonå†…å®¹æ˜¯å¦æ”¹åŠ¨
  workflow_dispatch:           # æ‰‹åŠ¨æ‰§è¡Œå¤‡ä»½
    inputs:
      clean_mode:
        description: 'æ˜¯å¦æ¸…ç†æœªåœ¨ script-gist.json ä¸­çš„ä¿ç•™çš„å†å²æ–‡ä»¶?(true=æ¸…ç†ï¼Œfalse=ä¸æ¸…ç†)'
        required: false
        default: 'false'
      notify_lang:
        description: 'é€šçŸ¥è¯­è¨€ (en-us=è‹±æ–‡ï¼Œzh-cn=ä¸­æ–‡)'
        required: false
        default: 'zh-cn'
      target_branch:
        description: 'è¦æ¨é€åˆ°å“ªä¸ªåˆ†æ”¯ï¼Ÿï¼ˆé»˜è®¤ mainï¼‰'
        required: false
        default: 'main'  

env:
  CLEAN_MODE: ${{ github.event.inputs.clean_mode }}            # è°¨æ…å¼€å¯ã€‚å¦‚ä½ çš„é…ç½®æ–‡ä»¶é“¾æ¥è®¿é—®å¤±è´¥/ä½ ç§»é™¤äº†éƒ¨åˆ†æ–‡ä»¶ï¼Œå¼€å¯åå·¥ä½œæµæ‰§è¡Œå®Œæ¯•ä¼šå°†ä½ å¤‡ä»½çš„å¯¹åº”æ–‡ä»¶ç§»é™¤ï¼Œå³æ˜¯å¦æ¸…ç†æœªåœ¨ script-gist.json ä¸­çš„ä¿ç•™çš„å†å²æ–‡ä»¶ï¼ˆtrue/falseï¼‰
  TARGET_BRANCH: ${{ github.event.inputs.target_branch }}      # æ¨é€åˆ†æ”¯ é»˜è®¤main
  FORCE_NOTIFY: true                                           # è‡ªå®šä¹‰å¼€å¯ã€‚å¼ºåˆ¶æ¨é€é€šçŸ¥ï¼Œéœ€åœ¨ä»“åº“secreté‡Œæ·»åŠ é…ç½®ï¼Œæ­é…ä¸‹æ–¹å¯é€‰é€šçŸ¥æ–¹å¼ä½¿ç”¨ã€‚ï¼ˆtrue/falseï¼‰
  NOTIFY_LANG: ${{ github.event.inputs.notify_lang }}          # é€šçŸ¥è¯­è¨€é…ç½® ä»…æ”¯æŒä¸­è‹±åˆ‡æ¢ (zh-cnæˆ–en-us)
  BARK_PUSH_URL: ${{ secrets.BARK_PUSH_URL }}                  # Bark æ¨é€å®Œæ•´ URLï¼Œä¾‹å¦‚ï¼šhttps://api.day.app/ä½ çš„Key
  SERVERCHAN_SEND_KEY: ${{ secrets.SERVERCHAN_SEND_KEY }}      # Serveré…± SendKeyï¼ˆsct.ftqq.com è·å–ï¼‰
  WECHAT_WEBHOOK_URL: ${{ secrets.WECHAT_WEBHOOK_URL }}        # ä¼ä¸šå¾®ä¿¡æœºå™¨äºº Webhook åœ°å€
  TG_BOT_TOKEN: ${{ secrets.TG_BOT_TOKEN }}                    # Telegram Bot Tokenï¼ˆBotFather è·å–ï¼‰
  TG_USER_ID: ${{ secrets.TG_USER_ID }}                        # Telegram ç”¨æˆ· IDï¼ˆé€šè¿‡ @userinfobot è·å–ï¼‰
  BARK_ICON_URL: ${{ secrets.BARK_ICON_URL }}                  # bark app å±•ç¤ºå›¾æ ‡

jobs:
  run-script:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'

      - name: Install Requests
        run: pip install requests 

      - name: Set up Git user
        run: |
          git config --global user.email "41898282+github-actions[bot]@users.noreply.github.com"
          git config --global user.name "github-actions[bot]"        

      - name: Run sync-FILES.py
        run: python3 .github/py/sync-FILES.py
